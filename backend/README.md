# Backend

## Обзор

```
├── src
│   ├── api
│   │   └── http
│   │       ├── controllers
│   │       └── schemas
│   ├── application
│   │   ├── repositories
│   │   │   ├── implementations
│   │   │   └── interfaces
│   │   └── services
│   ├── domain
│   │   └── entities
│   ├── infrastructure
│   │   ├── logging
│   │   └── storages
│   │       ├── implementations
│   │       ├── interfaces
│   │       └── models
│   ├── app.module.ts
│   └── main.ts
├── README.md
├── package-lock.json
├── package.json
└── tsconfig.json
```

## Директории

### `/src`

Основная директория для исходного кода проекта.

### `/src/api`

Директория, включающая файлы, связанные с API. В её состав входят описания контроллеров и схем запросов. Здесь может
находиться не только описание различных протоколов взаимодействия, таких как OpenAPI/Swagger, JSON, GRPC,
но и контракты сообщений для Kafka топиков.

### `/src/api/http`

Директория, включающая файлы, связанные с HTTP API. Здесь находятся контроллеры (`controllers`), ответственные за
обработку запросов от клиентов, а также описания запросов и ответов, используемых в API.

#### Замечание

Если рассматривать приложение как сервер, реализующий HTTP API, то контроллеры можно переместить в директорию
`application`. Это предложение основывается на разделении логики приложения и логики домена.

Представим, что мы разрабатываем сервер, предоставляющий API для наложения фильтров на изображения.
У нас есть правила, ограничивающие количество применений фильтров для каждого пользователя. Эти правила являются
частью логики приложения. Реализации алгоритмов и фильтров уже включают в себя уровень логики домена. Такая логика
должна быть размещена в директории domain, поскольку её можно в любой момент извлечь для создания CLI-утилиты или
десктопного приложения. В данном примере, смешивая эти правила, мы усложняем возможное разделение на несколько
отдельных приложений.

### `/src/application`

Директория содержит файлы, относящиеся к слою приложения.

### `/src/application/repositories`

В этой директории размещаются репозитории, ответственные за взаимодействие с данными. Этот слой должен включать в
себя правила преобразования бизнес-сущностей в сущности уровня хранилища. Приведу несколько примеров.

* Сервис для поиска путей:
    * Уровень бизнес-логики: двунаправленный граф.
    * Уровень хранилища: матрица расстояний.
* Сервис работы с бинарным деревом поиска:
    * Уровень бизнес-логики: бинарное дерево поиска в виде связанных узлов на указателях.
    * Уровень хранилища: плоское представление в виде строки с вложенными
      скобками (`(8 (3 (1) (6 (4) (7))) (10 (14 (13))))`).

Соответствующие интерфейсы, определяющие контракты для репозиториев, находятся в директории `interfaces`. В директории
`implementations` содержатся конкретные реализации.

// TODO: может обработать ошибки уровня инфраструктуры и преобразовать их в ошибки уровня бизнес-логики.

### `/src/application/services`

В этой директории можно разместить сервисы, описывающие бизнес-логику приложения. Рекомендуется разделить их на
интерфейсы и реализацию для достижения лучшей структурированности проекта.

Этот слой взаимодействует исключительно с бизнес-сущностями (`/src/domain/entities`). Следовательно, он принимает их
на вход, и передает их в репозитории. Код этого уровня организован примерно следующим
образом: `controllers -> SERVICE -> repositories -> storage -> (database|file system|cloud storage)`.

// TODO: поднимает только ошибки уровня бизнес-логики, не должен обрабатывать ошибки инфраструктуры

**P.S.:** Также существует подход, согласно которому на этом уровне описывается конкретный бизнес-функционал, а
сценарии, состоящие из нескольких функций, описываются в use case. Например:

* **Сервис взаимодействия с учетными записями пользователей:**
    * Определяет логику поиска пользователей.
* **Сервис взаимодействия с ролями пользователей:**
    * Определяет логику получения списка ролей пользователей.
    * Определяет логику проверки возможности редактирования данных у пользователя с заданным списком ролей.
* **Use case описывает операцию редактирования ролей пользователей админом:**
    * Ищет учетную запись админа.
    * Получает список ролей админа.
    * Проверяет, есть ли у администратора возможность редактировать список ролей.
    * Ищет учетную запись обычного пользователя.
    * Получает список ролей обычного пользователя.
    * Изменяет список ролей обычного пользователя и сохраняет изменения.

### `/domain`

Здесь размещаются файлы, связанные с бизнес-логикой домена. Это общие элементы, не зависящие от того, где приложение
запущено или какой инфраструктурой оно оперирует.

### `/domain/entities`

В этой директории могут находиться сущности, представляющие бизнес-объекты.

### `/infrastructure`

Здесь находятся файлы, связанные с инфраструктурными задачами.

### `/infrastructure/storages`

В этой директории могут находиться файлы, связанные с хранилищами данных.

### `/infrastructure/logging`


